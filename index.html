<!doctype html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tich√° studovna ¬∑ junior.guru</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Love+Ya+Like+A+Sister&family=Cabin+Sketch:wght@400;700&subset=latin-ext&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Dekorace -->
    <div class="deco deco-star">‚ú¶</div>
    <div class="deco deco-star-2">‚úß</div>
    <div class="deco deco-star-3">‚ú¶</div>

    <!-- Konfety canvas -->
    <canvas id="confettiCanvas"></canvas>

    <!-- Oslava overlay -->
    <div class="celebration-overlay" id="celebrationOverlay">
      <div class="celebration-content">
        <img
          src="./src/junior-guru-maskot-logo-na-tmave-pozadi-{dark-background}-rgb.svg"
          alt="Ku≈ô√°tko slav√≠!"
          class="celebration-mascot"
        />
        <div class="celebration-text">Skvƒõl√° pr√°ce!</div>
        <button class="celebration-dismiss" onclick="dismissCelebration()">
          Tak zase p≈ô√≠≈°tƒõ!
        </button>
      </div>
    </div>

    <!--
    === ZVUK PO DOKONƒåEN√ç ===
    Vlo≈æ sv≈Øj zvukov√Ω soubor (MP3, OGG, WAV...) do stejn√© slo≈æky
    a uprav cestu v atributu "src" n√≠≈æe.
    P≈ô√≠klady:
      <source src="zvuk-hotovo.mp3" type="audio/mpeg">
      <source src="zvuk-hotovo.ogg" type="audio/ogg">
      <source src="zvuk-hotovo.wav" type="audio/wav">
  -->
    <audio id="finishSound" preload="auto">
      <source src="zvuk-hotovo.mp3" type="audio/mpeg" />
      <!-- Sem m≈Ø≈æe≈° p≈ôidat dal≈°√≠ form√°ty jako z√°lohu: -->
      <!-- <source src="zvuk-hotovo.ogg" type="audio/ogg"> -->
    </audio>

    <!-- Header -->
    <header class="header">
      <h2>Tich√° studovna</h2>
    </header>

    <!-- Main -->
    <main class="main">
      <!-- Maskot -->
      <!-- 
    <div class="mascot-container">
      <img
        src="./src/junior-guru-maskot-logo-na-svetle-pozadi-{light-background}-rgb.svg"
        alt="Ku≈ô√°tko junior.guru"
        class="mascot"
      >
    </div>
    -->

      <!-- Timer -->
      <div class="timer-section">
        <div class="timer-title">‚è± Odpoƒçet studijn√≠ho ƒçasu</div>

        <div class="timer-display-container">
          <div class="timer-set-button">
            <button class="timer-arrow" onclick="decrementTime()">‚àí</button>
          </div>
          <div class="timer-display" id="timerDisplay">60:00</div>
          <div class="timer-set-button">
            <button class="timer-arrow" onclick="incrementTime()">+</button>
          </div>
        </div>

        <div class="timer-controls">
          <button class="btn btn-primary" id="startBtn" onclick="startTimer()">
            ‚ñ∂ Start
          </button>
          <button
            class="btn btn-secondary"
            id="pauseBtn"
            onclick="pauseTimer()"
            style="display: none"
          >
            ‚è∏ Pauza
          </button>
          <button
            class="btn btn-secondary"
            id="resetBtn"
            onclick="resetTimer()"
          >
            ‚Ü∫ Reset
          </button>
        </div>

        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 100%"></div>
        </div>

        <div class="done-message" id="doneMessage"></div>
      </div>

      <!-- Hodiny -->
      <div class="clock-section">
        <div class="clock-label">aktu√°ln√≠ ƒças</div>
        <div class="clock" id="clock">00:00:00</div>
      </div>

      <!-- Motivace -->
      <p class="motivation" id="motivation"></p>
    </main>

    <!-- Footer -->
    <footer class="footer">
      Tich√° studovna ¬∑
      <a href="https://junior.guru/" target="_blank" rel="noopener"
        >junior.guru</a
      >
    </footer>

    <script>
      // =========================================================
      //  HODINY
      // =========================================================
      function updateClock() {
        var now = new Date();
        var h = String(now.getHours()).padStart(2, "0");
        var m = String(now.getMinutes()).padStart(2, "0");
        var s = String(now.getSeconds()).padStart(2, "0");
        document.getElementById("clock").textContent = h + ":" + m + ":" + s;
      }

      setInterval(updateClock, 1000);
      updateClock();

      // =========================================================
      //  KONFETY (canvas animace)
      // =========================================================
      var confettiCanvas = document.getElementById("confettiCanvas");
      var confettiCtx = confettiCanvas.getContext("2d");
      var confettiPieces = [];
      var confettiAnimationId = null;

      // Barvy konfet ‚Äî junior.guru paleta + dopl≈àkov√©
      var confettiColors = [
        "#fffa72", // ≈ælut√°
        "#343434", // ƒçern√°
        "#1755d1", // modr√° (link)
        "#d94a38", // ƒçerven√°
        "#4caf50", // zelen√°
        "#ff9800", // oran≈æov√°
        "#e91e63", // r≈Ø≈æov√°
      ];

      function resizeConfettiCanvas() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      }

      window.addEventListener("resize", resizeConfettiCanvas);
      resizeConfettiCanvas();

      /**
       * Vytvo≈ô√≠ jednu konfetu s n√°hodn√Ωmi vlastnostmi.
       * Konfeta pad√° shora dol≈Ø, ot√°ƒç√≠ se a m√≠rnƒõ se k√Ωve do stran.
       */
      function createConfettiPiece() {
        return {
          x: Math.random() * confettiCanvas.width,
          y: -10 - Math.random() * 40,
          width: 6 + Math.random() * 6,
          height: 10 + Math.random() * 6,
          color:
            confettiColors[Math.floor(Math.random() * confettiColors.length)],
          rotation: Math.random() * 360,
          rotationSpeed: (Math.random() - 0.5) * 8,
          speedY: 2 + Math.random() * 3,
          speedX: (Math.random() - 0.5) * 2,
          wobble: Math.random() * Math.PI * 2,
          wobbleSpeed: 0.03 + Math.random() * 0.05,
        };
      }

      /**
       * Spust√≠ animaci konfet.
       * Vytvo≈ô√≠ d√°vku konfet a pak je nech√° padat.
       */
      function launchConfetti() {
        confettiPieces = [];

        // Vytvo≈ô√≠me 120 konfet najednou
        for (var i = 0; i < 120; i++) {
          var piece = createConfettiPiece();
          // Rozlo≈æ√≠me start v ƒçase ‚Äî nƒõkter√© padaj√≠ d≈ô√≠v, jin√© pozdƒõji
          piece.y = -10 - Math.random() * 300;
          confettiPieces.push(piece);
        }

        if (!confettiAnimationId) {
          animateConfetti();
        }
      }

      function animateConfetti() {
        confettiCtx.clearRect(
          0,
          0,
          confettiCanvas.width,
          confettiCanvas.height,
        );

        var alive = false;

        for (var i = 0; i < confettiPieces.length; i++) {
          var p = confettiPieces[i];

          p.y += p.speedY;
          p.x += p.speedX + Math.sin(p.wobble) * 0.5;
          p.rotation += p.rotationSpeed;
          p.wobble += p.wobbleSpeed;

          // Pokud konfeta je≈°tƒõ nevypadla z obrazovky
          if (p.y < confettiCanvas.height + 20) {
            alive = true;

            confettiCtx.save();
            confettiCtx.translate(p.x, p.y);
            confettiCtx.rotate((p.rotation * Math.PI) / 180);
            confettiCtx.fillStyle = p.color;
            confettiCtx.fillRect(
              -p.width / 2,
              -p.height / 2,
              p.width,
              p.height,
            );
            confettiCtx.restore();
          }
        }

        if (alive) {
          confettiAnimationId = requestAnimationFrame(animateConfetti);
        } else {
          // V≈°echny konfety dopadly ‚Äî uklid√≠me
          confettiAnimationId = null;
          confettiPieces = [];
          confettiCtx.clearRect(
            0,
            0,
            confettiCanvas.width,
            confettiCanvas.height,
          );
        }
      }

      // =========================================================
      //  OSLAVA (overlay s ku≈ô√°tkem)
      // =========================================================
      var celebrationOverlay = document.getElementById("celebrationOverlay");

      function showCelebration() {
        celebrationOverlay.classList.add("visible");
      }

      function dismissCelebration() {
        celebrationOverlay.classList.remove("visible");
      }

      // =========================================================
      //  ZVUK
      // =========================================================
      var finishSound = document.getElementById("finishSound");

      /**
       * P≈ôehraje zvuk po dokonƒçen√≠ odpoƒçtu.
       *
       * Jak p≈ôidat vlastn√≠ zvuk:
       * 1. Vlo≈æ zvukov√Ω soubor (nap≈ô. zvuk-hotovo.mp3) do stejn√©
       *    slo≈æky jako tento HTML soubor.
       * 2. V elementu <audio id="finishSound"> uprav atribut src
       *    v <source> tagu tak, aby odpov√≠dal n√°zvu tv√©ho souboru.
       *
       * Podporovan√© form√°ty: MP3, OGG, WAV
       *
       * Pokud zvuk nen√≠ nalezen, nic se nestane ‚Äî str√°nka
       * funguje i bez nƒõj.
       */
      function playFinishSound() {
        try {
          finishSound.currentTime = 0;
          finishSound.play();
        } catch (e) {
          // Zvukov√Ω soubor nebyl nalezen nebo prohl√≠≈æeƒç zablokoval
          // p≈ôehr√°n√≠ ‚Äî nevad√≠, str√°nka funguje i bez zvuku.
        }
      }

      // =========================================================
      //  TIMER
      // =========================================================
      var timerInterval = null;
      var totalSeconds = 60 * 60;
      var remainingSeconds = totalSeconds;
      var isRunning = false;

      var timerDisplay = document.getElementById("timerDisplay");
      var progressBar = document.getElementById("progressBar");
      var startBtn = document.getElementById("startBtn");
      var pauseBtn = document.getElementById("pauseBtn");
      var doneMessage = document.getElementById("doneMessage");

      function formatTime(seconds) {
        var m = Math.floor(seconds / 60);
        var s = seconds % 60;
        return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
      }

      function updateDisplay() {
        timerDisplay.textContent = formatTime(remainingSeconds);

        var progress =
          totalSeconds > 0 ? (remainingSeconds / totalSeconds) * 100 : 0;
        progressBar.style.width = progress + "%";

        timerDisplay.classList.toggle(
          "warning",
          remainingSeconds <= 300 && remainingSeconds > 0 && isRunning,
        );
        timerDisplay.classList.toggle("done", remainingSeconds === 0);

        if (isRunning) {
          document.title = formatTime(remainingSeconds) + " ¬∑ Tich√° studovna";
        } else if (remainingSeconds === 0) {
          document.title = "Hotovo! ¬∑ Tich√° studovna";
        } else {
          document.title = "Tich√° studovna ¬∑ junior.guru";
        }
      }

      function startTimer() {
        if (remainingSeconds <= 0) return;

        isRunning = true;
        doneMessage.classList.remove("visible");

        startBtn.style.display = "none";
        pauseBtn.style.display = "inline-block";

        document.querySelectorAll(".preset-btn").forEach(function (btn) {
          btn.disabled = true;
        });

        timerInterval = setInterval(function () {
          remainingSeconds--;
          updateDisplay();

          if (remainingSeconds <= 0) {
            clearInterval(timerInterval);
            timerInterval = null;
            isRunning = false;
            timerFinished();
          }
        }, 1000);
      }

      function pauseTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
        isRunning = false;

        startBtn.style.display = "inline-block";
        startBtn.textContent = "‚ñ∂ Pokraƒçovat";
        pauseBtn.style.display = "none";

        timerDisplay.classList.remove("warning");
        document.title = "Tich√° studovna ¬∑ junior.guru";
      }

      function resetTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
        isRunning = false;

        startBtn.style.display = "inline-block";
        startBtn.textContent = "‚ñ∂ Start";
        pauseBtn.style.display = "none";
        doneMessage.classList.remove("visible");

        document.querySelectorAll(".preset-btn").forEach(function (btn) {
          btn.disabled = false;
        });

        timerDisplay.classList.remove("warning", "done");

        // Schovat oslavu, pokud je vidƒõt
        dismissCelebration();

        // Reset ƒçasu na nastavenou hodnotu
        remainingSeconds = totalSeconds;

        updateDisplay();
        document.title = "Tich√° studovna ¬∑ junior.guru";
      }

      /**
       * Zavol√° se, kdy≈æ odpoƒçet dos√°hne nuly.
       * Spust√≠ t≈ôi vƒõci:
       *   1. P≈ôehraje zvuk (z <audio> elementu)
       *   2. Vyst≈ôel√≠ konfety (canvas animace)
       *   3. Uk√°≈æe overlay s ku≈ô√°tkem a tlaƒç√≠tkem
       */
      function timerFinished() {
        doneMessage.classList.add("visible");
        startBtn.style.display = "none";
        pauseBtn.style.display = "none";
        updateDisplay();

        playFinishSound();
        launchConfetti();
        showCelebration();
      }

      // ≈†ipky pro zmƒõnu ƒçasu
      function incrementTime() {
        if (isRunning) return;

        var currentMinutes = Math.floor(totalSeconds / 60);
        var newMinutes = currentMinutes + 1;
        if (newMinutes > 180) newMinutes = 180;

        totalSeconds = newMinutes * 60;
        remainingSeconds = totalSeconds;
        updateDisplay();
      }

      function decrementTime() {
        if (isRunning) return;

        var currentMinutes = Math.floor(totalSeconds / 60);
        var newMinutes = currentMinutes - 1;
        if (newMinutes < 1) newMinutes = 1;

        totalSeconds = newMinutes * 60;
        remainingSeconds = totalSeconds;
        updateDisplay();
      }

      // Presety
      function setPreset(mins) {
        if (isRunning) return;

        totalSeconds = mins * 60;
        remainingSeconds = totalSeconds;

        document.querySelectorAll(".preset-btn").forEach(function (btn) {
          btn.classList.toggle(
            "active",
            parseInt(btn.dataset.minutes) === mins,
          );
        });

        doneMessage.classList.remove("visible");
        timerDisplay.classList.remove("done", "warning");
        startBtn.style.display = "inline-block";
        startBtn.textContent = "‚ñ∂ Start";
        updateDisplay();
      }

      // Motivace
      var quotes = [
        "Ka≈æd√Ω krok se poƒç√≠t√°. üê£",
        "Kdo se uƒç√≠, ten roste.",
        "Dneska je ten den, kdy se posune≈° d√°l.",
        "Tich√Ω fokus, velk√Ω pokrok.",
        "Spoleƒçnƒõ, i kdy≈æ ka≈æd√Ω s√°m.",
        "Chyby jsou souƒç√°st uƒçen√≠.",
        "Mal√© kroky vedou k velk√Ωm vƒõcem.",
        "Tvoje budouc√≠ j√° ti podƒõkuje.",
      ];

      document.getElementById("motivation").textContent =
        quotes[Math.floor(Math.random() * quotes.length)];

      // Init
      updateDisplay();
    </script>
  </body>
</html>
